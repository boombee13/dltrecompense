<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏Å‡∏±‡∏î</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #fcfaf8; 
            --table-bg: #ffffff;
            --header-bg: #ffd6c9; 
            --header-text: #5e5c5c;
            --row-hover: #fff3ed; 
            --text-main: #6b6b6b;
            --btn-map: #b5ead7; 
            --btn-map-hover: #9bd6c2;
            --btn-action: #ffbba6;
            --btn-action-hover: #ffa48a;
            --link-color: #a2add0; 
            --tab-bg: #f1f1f1;
            --tab-active: #ffbba6; 
        }
        
        body { font-family: 'Sarabun', sans-serif; padding: 30px 15px; background-color: var(--bg-color); color: var(--text-main); margin: 0; font-size: 15px; }
        h2 { text-align: center; color: #7b7b7b; margin-bottom: 20px; font-weight: 600; }
        
        .tabs-container { display: flex; justify-content: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { font-family: 'Sarabun', sans-serif; padding: 10px 24px; border: none; background-color: var(--tab-bg); color: var(--text-main); border-radius: 25px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .tab-btn:hover { background-color: #e2e2e2; }
        .tab-btn.active { background-color: var(--tab-active); color: white; box-shadow: 0 4px 10px rgba(255, 187, 166, 0.4); }

        .table-container { border-radius: 16px; overflow-x: auto; -webkit-overflow-scrolling: touch; box-shadow: 0 8px 24px rgba(0,0,0,0.04); background: var(--table-bg); max-width: 1100px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th, td { padding: 16px 20px; text-align: left; border-bottom: 1px solid #f4f4f4; white-space: nowrap; }
        th { background-color: var(--header-bg); color: var(--header-text); font-weight: 600; font-size: 16px; }
        tr:hover td { background-color: var(--row-hover); }

        a.link-text { color: var(--link-color); text-decoration: none; font-weight: 600; }
        a.link-text:hover { text-decoration: underline; }

        a.btn { display: inline-block; padding: 8px 18px; background: var(--btn-map); color: #5a7065; text-decoration: none; border-radius: 20px; font-size: 14px; font-weight: 600; transition: all 0.3s ease; }
        a.btn:hover { background: var(--btn-map-hover); transform: translateY(-1px); }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏¢‡πâ‡∏≤‡∏¢‡∏£‡∏π‡∏õ */
        button.btn-action { font-family: 'Sarabun', sans-serif; padding: 8px 18px; background: var(--btn-action); color: white; border: none; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        button.btn-action:hover { background: var(--btn-action-hover); transform: translateY(-1px); }
        button.btn-action:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        
        .status-badge { background-color: #f1f1f1; padding: 6px 12px; border-radius: 12px; font-size: 14px; color: #777; }
    </style>
</head>
<body>

    <h2>‚ú® ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h2>
    
    <div class="tabs-container">
        <button class="tab-btn active" onclick="filterData('‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', this)">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (All)</button>
        <button class="tab-btn" onclick="filterData('‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£', this)">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</button>
        <button class="tab-btn" onclick="filterData('Moved', this)">‡∏¢‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß (Moved)</button>
    </div>
    
    <div class="table-container">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Link</th>
                    <th>Road</th>
                    <th>Sub District</th>
                    <th>District</th>
                    <th>Province</th>
                    <th>Location</th>
                    <th>Status</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th> </tr>
            </thead>
            <tbody>
                <tr><td colspan="8" style="text-align:center; padding: 30px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        // üö® 1. ‡πÉ‡∏™‡πà API ‡∏Ç‡∏≠‡∏á Google Apps Script
        const API_URL = 'https://script.google.com/macros/s/AKfycbwoKn0sBWgxZVHenqQJn-ky8ttWxREAoZykk4qnCUMEsBP48KyXhCC2upufaPzlJXo/exec'; 
        
        // üö® 2. ‡πÉ‡∏™‡πà Webhook URL ‡∏Ç‡∏≠‡∏á n8n (‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á)
        const N8N_WEBHOOK_URL = 'https://boombee130.app.n8n.cloud/webhook/trigger-move';

        let allData = []; 

        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                const getValue = (row, keyName) => {
                    const actualKey = Object.keys(row).find(k => k.trim() === keyName);
                    return actualKey ? row[actualKey] : '';
                };

                allData = data.filter(row => {
                    const dateVal = getValue(row, 'Date');
                    const linkVal = getValue(row, 'Link');
                    return (dateVal !== '' && dateVal !== undefined) || (linkVal !== '' && linkVal !== undefined);
                }).map(row => {
                    return {
                        rowNumber: row['rowNumber'], // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ n8n
                        date: getValue(row, 'Date'),
                        time: getValue(row, 'Time'),
                        link: getValue(row, 'Link'),
                        road: getValue(row, 'Road'),
                        subDistrict: getValue(row, 'Sub District'),
                        district: getValue(row, 'District'),
                        province: getValue(row, 'Province'),
                        location: getValue(row, 'Location'),
                        status: getValue(row, 'Status') || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'
                    };
                });

                renderTable(allData);
            } catch (error) {
                document.querySelector('#dataTable tbody').innerHTML = '<tr><td colspan="8" style="text-align:center; padding: 40px; color: #ff8b8b;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
            }
        }

        function renderTable(dataToRender) {
            const tbody = document.querySelector('#dataTable tbody');
            tbody.innerHTML = ''; 

            if (dataToRender.length === 0) {
                 tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding: 40px; color: #aaa;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                 return;
            }

            dataToRender.forEach(row => {
                const tr = document.createElement('tr');
                const linkImg = row.link ? `<a href="${row.link}" class="link-text" target="_blank">‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</a>` : '-';
                const linkMap = row.location ? `<a href="${row.location}" class="btn" target="_blank">‡πÄ‡∏õ‡∏¥‡∏î Google Maps</a>` : '-';
                
                // ‡πÄ‡∏ä‡πá‡∏Å‡∏ß‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏¢‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏ã‡πâ‡∏≥
                const actionBtn = (row.status === 'Moved' || row.status === '‡∏¢‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß') 
                    ? `<span style="color: #aaa; font-size: 13px;">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</span>` 
                    : `<button class="btn-action" onclick="triggerMove('${row.rowNumber}', this)">‡∏™‡∏±‡πà‡∏á‡∏¢‡πâ‡∏≤‡∏¢</button>`;

                tr.innerHTML = `
                    <td>${row.date || '-'}</td>
                    <td>${row.time || '-'}</td>
                    <td>${linkImg}</td>
                    <td>${row.road || '-'}</td>
                    <td>${row.subDistrict || '-'}</td>
                    <td>${row.district || '-'}</td>
                    <td>${row.province || '-'}</td>
                    <td>${linkMap}</td>
                    <td><span class="status-badge status-text">${row.status}</span></td>
                    <td>${actionBtn}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filterData(statusFilter, btnElement) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');

            if (statusFilter === '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') {
                renderTable(allData);
            } else {
                const filteredData = allData.filter(row => row.status === statusFilter);
                renderTable(filteredData);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô n8n
        async function triggerMove(rowNumber, btnElement) {
            btnElement.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏±‡πà‡∏á...";
            btnElement.disabled = true; // ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡πÄ‡∏ö‡∏¥‡πâ‡∏•

            try {
                // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà n8n ‡πÇ‡∏î‡∏¢‡πÅ‡∏ô‡∏ö‡πÄ‡∏•‡∏Ç‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î (?row=...) ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ (‡πÉ‡∏ä‡πâ mode no-cors ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Error ‡∏Ç‡πâ‡∏≤‡∏°‡πÇ‡∏î‡πÄ‡∏°‡∏ô)
                await fetch(`${N8N_WEBHOOK_URL}?row=${rowNumber}`, { mode: 'no-cors' });
                
                // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß Workflow 2 ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏≠‡∏á)
                btnElement.innerText = "‡∏™‡∏±‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß";
                const tr = btnElement.closest('tr');
                tr.querySelector('.status-text').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡πâ‡∏≤‡∏¢...";
                tr.querySelector('.status-text').style.backgroundColor = "#fff3cd";

            } catch (error) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ n8n");
                btnElement.innerText = "‡∏™‡∏±‡πà‡∏á‡∏¢‡πâ‡∏≤‡∏¢";
                btnElement.disabled = false;
            }
        }

        fetchData();
    </script>
</body>
</html>



